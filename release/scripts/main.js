/*

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/
function ca(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}function n(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):{next:ca(a)}}var da="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b},p="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};
function ea(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");}var q=ea(this);function r(a,b){if(b)a:{var c=q;a=a.split(".");for(var d=0;d<a.length-1;d++){var h=a[d];if(!(h in c))break a;c=c[h]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&p(c,a,{configurable:!0,writable:!0,value:b})}}var t;
if("function"==typeof Object.setPrototypeOf)t=Object.setPrototypeOf;else{var v;a:{var fa={a:!0},ha={};try{ha.__proto__=fa;v=ha.a;break a}catch(a){}v=!1}t=v?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var ia=t;function x(){this.l=!1;this.h=null;this.s=void 0;this.g=1;this.A=this.j=0;this.i=null}function y(a){if(a.l)throw new TypeError("Generator is already running");a.l=!0}x.prototype.u=function(a){this.s=a};
function z(a,b){a.i={K:b,P:!0};a.g=a.j||a.A}x.prototype.return=function(a){this.i={return:a};this.g=this.A};function B(a,b,c){a.g=c;return{value:b}}function ja(a){a.g=0;a.j=0}function ka(a){a.j=0;var b=a.i.K;a.i=null;return b}function la(a){this.g=new x;this.h=a}function ma(a,b){y(a.g);var c=a.g.h;if(c)return C(a,"return"in c?c["return"]:function(d){return{value:d,done:!0}},b,a.g.return);a.g.return(b);return D(a)}
function C(a,b,c,d){try{var h=b.call(a.g.h,c);if(!(h instanceof Object))throw new TypeError("Iterator result "+h+" is not an object");if(!h.done)return a.g.l=!1,h;var l=h.value}catch(f){return a.g.h=null,z(a.g,f),D(a)}a.g.h=null;d.call(a.g,l);return D(a)}function D(a){for(;a.g.g;)try{var b=a.h(a.g);if(b)return a.g.l=!1,{value:b.value,done:!1}}catch(c){a.g.s=void 0,z(a.g,c)}a.g.l=!1;if(a.g.i){b=a.g.i;a.g.i=null;if(b.P)throw b.K;return{value:b.return,done:!0}}return{value:void 0,done:!0}}
function na(a){this.next=function(b){y(a.g);a.g.h?b=C(a,a.g.h.next,b,a.g.u):(a.g.u(b),b=D(a));return b};this.throw=function(b){y(a.g);a.g.h?b=C(a,a.g.h["throw"],b,a.g.u):(z(a.g,b),b=D(a));return b};this.return=function(b){return ma(a,b)};this[Symbol.iterator]=function(){return this}}function oa(a){function b(d){return a.next(d)}function c(d){return a.throw(d)}return new Promise(function(d,h){function l(f){f.done?d(f.value):Promise.resolve(f.value).then(b,c).then(l,h)}l(a.next())})}
function E(a){return oa(new na(new la(a)))}r("Symbol",function(a){function b(h){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new c("jscomp_symbol_"+(h||"")+"_"+d++,h)}function c(h,l){this.g=h;p(this,"description",{configurable:!0,writable:!0,value:l})}if(a)return a;c.prototype.toString=function(){return this.g};var d=0;return b});
r("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=q[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&p(d.prototype,a,{configurable:!0,writable:!0,value:function(){return pa(ca(this))}})}return a});function pa(a){a={next:a};a[Symbol.iterator]=function(){return this};return a}
r("Promise",function(a){function b(f){this.h=0;this.i=void 0;this.g=[];this.u=!1;var e=this.j();try{f(e.resolve,e.reject)}catch(g){e.reject(g)}}function c(){this.g=null}function d(f){return f instanceof b?f:new b(function(e){e(f)})}if(a)return a;c.prototype.h=function(f){if(null==this.g){this.g=[];var e=this;this.i(function(){e.l()})}this.g.push(f)};var h=q.setTimeout;c.prototype.i=function(f){h(f,0)};c.prototype.l=function(){for(;this.g&&this.g.length;){var f=this.g;this.g=[];for(var e=0;e<f.length;++e){var g=
f[e];f[e]=null;try{g()}catch(k){this.j(k)}}}this.g=null};c.prototype.j=function(f){this.i(function(){throw f;})};b.prototype.j=function(){function f(k){return function(m){g||(g=!0,k.call(e,m))}}var e=this,g=!1;return{resolve:f(this.H),reject:f(this.l)}};b.prototype.H=function(f){if(f===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(f instanceof b)this.N(f);else{a:switch(typeof f){case "object":var e=null!=f;break a;case "function":e=!0;break a;default:e=!1}e?this.G(f):this.s(f)}};
b.prototype.G=function(f){var e=void 0;try{e=f.then}catch(g){this.l(g);return}"function"==typeof e?this.O(e,f):this.s(f)};b.prototype.l=function(f){this.A(2,f)};b.prototype.s=function(f){this.A(1,f)};b.prototype.A=function(f,e){if(0!=this.h)throw Error("Cannot settle("+f+", "+e+"): Promise already settled in state"+this.h);this.h=f;this.i=e;2===this.h&&this.M();this.D()};b.prototype.M=function(){var f=this;h(function(){if(f.F()){var e=q.console;"undefined"!==typeof e&&e.error(f.i)}},1)};b.prototype.F=
function(){if(this.u)return!1;var f=q.CustomEvent,e=q.Event,g=q.dispatchEvent;if("undefined"===typeof g)return!0;"function"===typeof f?f=new f("unhandledrejection",{cancelable:!0}):"function"===typeof e?f=new e("unhandledrejection",{cancelable:!0}):(f=q.document.createEvent("CustomEvent"),f.initCustomEvent("unhandledrejection",!1,!0,f));f.promise=this;f.reason=this.i;return g(f)};b.prototype.D=function(){if(null!=this.g){for(var f=0;f<this.g.length;++f)l.h(this.g[f]);this.g=null}};var l=new c;b.prototype.N=
function(f){var e=this.j();f.I(e.resolve,e.reject)};b.prototype.O=function(f,e){var g=this.j();try{f.call(e,g.resolve,g.reject)}catch(k){g.reject(k)}};b.prototype.then=function(f,e){function g(w,A){return"function"==typeof w?function(aa){try{k(w(aa))}catch(ba){m(ba)}}:A}var k,m,u=new b(function(w,A){k=w;m=A});this.I(g(f,k),g(e,m));return u};b.prototype.catch=function(f){return this.then(void 0,f)};b.prototype.I=function(f,e){function g(){switch(k.h){case 1:f(k.i);break;case 2:e(k.i);break;default:throw Error("Unexpected state: "+
k.h);}}var k=this;null==this.g?l.h(g):this.g.push(g);this.u=!0};b.resolve=d;b.reject=function(f){return new b(function(e,g){g(f)})};b.race=function(f){return new b(function(e,g){for(var k=n(f),m=k.next();!m.done;m=k.next())d(m.value).I(e,g)})};b.all=function(f){var e=n(f),g=e.next();return g.done?d([]):new b(function(k,m){function u(aa){return function(ba){w[aa]=ba;A--;0==A&&k(w)}}var w=[],A=0;do w.push(void 0),A++,d(g.value).I(u(w.length-1),m),g=e.next();while(!g.done)})};return b});
function qa(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""}r("String.prototype.repeat",function(a){return a?a:function(b){var c=qa(this,null,"repeat");if(0>b||1342177279<b)throw new RangeError("Invalid count value");b|=0;for(var d="";b;)if(b&1&&(d+=c),b>>>=1)c+=c;return d}});
r("Object.is",function(a){return a?a:function(b,c){return b===c?0!==b||1/b===1/c:b!==b&&c!==c}});r("Array.prototype.includes",function(a){return a?a:function(b,c){var d=this;d instanceof String&&(d=String(d));var h=d.length;c=c||0;for(0>c&&(c=Math.max(c+h,0));c<h;c++){var l=d[c];if(l===b||Object.is(l,b))return!0}return!1}});r("String.prototype.includes",function(a){return a?a:function(b,c){return-1!==qa(this,b,"includes").indexOf(b,c||0)}});
r("String.prototype.startsWith",function(a){return a?a:function(b,c){var d=qa(this,b,"startsWith"),h=d.length,l=b.length;c=Math.max(0,Math.min(c|0,d.length));for(var f=0;f<l&&c<h;)if(d[c++]!=b[f++])return!1;return f>=l}});function F(a,b){return Object.prototype.hasOwnProperty.call(a,b)}
r("WeakMap",function(a){function b(g){this.g=(e+=Math.random()+1).toString();if(g){g=n(g);for(var k;!(k=g.next()).done;)k=k.value,this.set(k[0],k[1])}}function c(){}function d(g){var k=typeof g;return"object"===k&&null!==g||"function"===k}function h(g){if(!F(g,f)){var k=new c;p(g,f,{value:k})}}function l(g){var k=Object[g];k&&(Object[g]=function(m){if(m instanceof c)return m;Object.isExtensible(m)&&h(m);return k(m)})}if(function(){if(!a||!Object.seal)return!1;try{var g=Object.seal({}),k=Object.seal({}),
m=new a([[g,2],[k,3]]);if(2!=m.get(g)||3!=m.get(k))return!1;m.delete(g);m.set(k,4);return!m.has(g)&&4==m.get(k)}catch(u){return!1}}())return a;var f="$jscomp_hidden_"+Math.random();l("freeze");l("preventExtensions");l("seal");var e=0;b.prototype.set=function(g,k){if(!d(g))throw Error("Invalid WeakMap key");h(g);if(!F(g,f))throw Error("WeakMap key fail: "+g);g[f][this.g]=k;return this};b.prototype.get=function(g){return d(g)&&F(g,f)?g[f][this.g]:void 0};b.prototype.has=function(g){return d(g)&&F(g,
f)&&F(g[f],this.g)};b.prototype.delete=function(g){return d(g)&&F(g,f)&&F(g[f],this.g)?delete g[f][this.g]:!1};return b});
r("Map",function(a){function b(){var e={};return e.v=e.next=e.head=e}function c(e,g){var k=e.g;return pa(function(){if(k){for(;k.head!=e.g;)k=k.v;for(;k.next!=k.head;)return k=k.next,{done:!1,value:g(k)};k=null}return{done:!0,value:void 0}})}function d(e,g){var k=g&&typeof g;"object"==k||"function"==k?l.has(g)?k=l.get(g):(k=""+ ++f,l.set(g,k)):k="p_"+g;var m=e.h[k];if(m&&F(e.h,k))for(e=0;e<m.length;e++){var u=m[e];if(g!==g&&u.key!==u.key||g===u.key)return{id:k,list:m,index:e,m:u}}return{id:k,list:m,
index:-1,m:void 0}}function h(e){this.h={};this.g=b();this.size=0;if(e){e=n(e);for(var g;!(g=e.next()).done;)g=g.value,this.set(g[0],g[1])}}if(function(){if(!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var e=Object.seal({x:4}),g=new a(n([[e,"s"]]));if("s"!=g.get(e)||1!=g.size||g.get({x:4})||g.set({x:4},"t")!=g||2!=g.size)return!1;var k=g.entries(),m=k.next();if(m.done||m.value[0]!=e||"s"!=m.value[1])return!1;m=k.next();return m.done||4!=m.value[0].x||
"t"!=m.value[1]||!k.next().done?!1:!0}catch(u){return!1}}())return a;var l=new WeakMap;h.prototype.set=function(e,g){e=0===e?0:e;var k=d(this,e);k.list||(k.list=this.h[k.id]=[]);k.m?k.m.value=g:(k.m={next:this.g,v:this.g.v,head:this.g,key:e,value:g},k.list.push(k.m),this.g.v.next=k.m,this.g.v=k.m,this.size++);return this};h.prototype.delete=function(e){e=d(this,e);return e.m&&e.list?(e.list.splice(e.index,1),e.list.length||delete this.h[e.id],e.m.v.next=e.m.next,e.m.next.v=e.m.v,e.m.head=null,this.size--,
!0):!1};h.prototype.clear=function(){this.h={};this.g=this.g.v=b();this.size=0};h.prototype.has=function(e){return!!d(this,e).m};h.prototype.get=function(e){return(e=d(this,e).m)&&e.value};h.prototype.entries=function(){return c(this,function(e){return[e.key,e.value]})};h.prototype.keys=function(){return c(this,function(e){return e.key})};h.prototype.values=function(){return c(this,function(e){return e.value})};h.prototype.forEach=function(e,g){for(var k=this.entries(),m;!(m=k.next()).done;)m=m.value,
e.call(g,m[1],m[0],this)};h.prototype[Symbol.iterator]=h.prototype.entries;var f=0;return h});function ra(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var d=c.slice();d.push.apply(d,arguments);return a.apply(this,d)}};function sa(a){var b=G,c=b.u;b.F&&(c=b.l*c/100);return Math.max(2,Math.floor(a*c))}
function ta(){var a=G;window.firebase.firestore().collection("configuration").orderBy("timestamp","desc").limit(1).onSnapshot(function(b){if(0<b.size){b=b.docs[0].data();a.G=b.hasOwnProperty("enabled")?b.enabled:a.G;a.D=b.hasOwnProperty("event_start")?b.event_start:a.D;a.j=b.hasOwnProperty("fallback_url")?b.fallback_url:a.j;a.g=b.hasOwnProperty("config")?b.callback_window_ms:a.g;a.u=b.hasOwnProperty("callback_threshold")?b.callback_threshold:a.u;a.F=b.hasOwnProperty("threshold_is_percentage")?b.threshold_is_percentage:
a.F;a.s=b.hasOwnProperty("admin_users")?b.admin_users:a.s;a.i=b.hasOwnProperty("youtube_video")?b.youtube_video:a.i;a.h=b.hasOwnProperty("youtube_chat")?b.youtube_chat:a.h;b=n(a.A);for(var c=b.next();!c.done;c=b.next())c=c.value,c(a)}},function(b){console.error("Error querying Firestore: ",b)});window.firebase.firestore().collection("_user_presence").where("sessions",">",{}).onSnapshot(function(b){if(0<b.size){a.l=b.docs.length;b=n(a.A);for(var c=b.next();!c.done;c=b.next())c=c.value,c(a)}},function(b){console.error("Error querying Firestore: ",
b)})}var G=new function(){this.G=!1;this.D=null;this.H=!1;this.j="";this.g=1E4;this.u=3;this.F=!1;this.l=0;this.h=this.i="";this.s=[];this.A=[]};function ua(a,b,c){c=c||va;for(var d=0,h=a.length,l;d<h;){var f=d+(h-d>>>1);var e=c(b,a[f]);0<e?d=f+1:(h=f,l=!e)}return l?d:-d-1}function va(a,b){return a>b?1:a<b?-1:0};function wa(){this.text="callback-message-";this.index=0}wa.prototype.next=function(){return this.text+this.index++};function xa(a){try{var b=new URL(a);/(.*\.)?googleusercontent\.com$/.test(b.hostname)&&b.searchParams.set("sz","150");return b.toString()}catch(c){if(c instanceof TypeError)return a;throw c;}}
function ya(a){var b=H().querySelectorAll(".message-container");if(0===b.length)return null;a=ua(b,a,function(c,d){d=za(d);return c-d});return a>=b.length||a<-b.length?null:0<=a?b[a+1]:b[-(a+1)]}function Aa(a){a[0].isIntersecting?(H().dataset.J=!0,document.getElementById("scroll-down-container").setAttribute("hidden",!0)):(delete H().dataset.J,0<H().querySelectorAll(".message").length&&document.getElementById("scroll-down-container").removeAttribute("hidden"))}
function I(a){a=Error.call(this,a);this.message=a.message;"stack"in a&&(this.stack=a.stack);this.name="TimestampNotFoundError"}var J=I,K=Error;J.prototype=da(K.prototype);J.prototype.constructor=J;if(ia)ia(J,K);else for(var L in K)if("prototype"!=L)if(Object.defineProperties){var Ba=Object.getOwnPropertyDescriptor(K,L);Ba&&Object.defineProperty(J,L,Ba)}else J[L]=K[L];J.V=K.prototype;
function za(a){var b=parseInt(a.getAttribute("timestamp"),10);if(!b)throw new I("Child "+a.id+" has no 'timestamp' attribute");return b}function Ca(){return document.getElementById("outer-container")}function Da(){return document.getElementById("error-container")}function M(){return document.getElementById("intro-container")}function H(){return document.getElementById("messages")}function N(){return document.getElementById("last-message")}function O(){return document.getElementById("message")}
function Ea(){return document.getElementById("user-name")}function Fa(){return document.getElementById("messages-card-container")}function Ga(){return document.getElementById("youtube-stream-container")}function P(){return document.getElementById("youtube-video")}function Q(){return document.getElementById("youtube-chat")}function Ha(){return document.getElementById("hidden-audio")};function R(a,b,c,d,h,l){this.text=a;this.i=b;this.h=c;this.L=d;this.g=h;this.weight=void 0===l?1:l;Date.now()}function Ia(a){a.g()&&a.g().removeAttribute("disabled")}function Ja(a){return"\ud83d\udc4f"===a.text||"\ud83d\udc4e"===a.text?a.text.repeat(S(3,6)):a.text+"!".repeat(S(1,3))+"1".repeat(S(0,2))+"!".repeat(S(1,2))}function Ka(a){return"\ud83d\udc4f"===a.text||"\ud83d\udc4e"===a.text?a.text:a.text+"!!"}
function T(a){return"\ud83d\udc4f"===a.text?"APPLAUSE":"\ud83d\udc4e"===a.text?"BOO":a.text}function S(a,b){return a+Math.floor(Math.random()*(b-a+1))}
var U=[new R("SCIENCE","\ud83d\udd2c","science1.mp4 science2.mp4 science3.mp4 science4.mp4 science5.mp4 science6.mp4 science7.mp4".split(" "),function(){return document.getElementById("science-form")},function(){return document.getElementById("science")}),new R("ART","\ud83c\udfa8",["art1.mp4","art2.mp4","art3.mp4"],function(){return document.getElementById("art-form")},function(){return document.getElementById("art")}),new R("MAPS","\ud83d\uddfa\ufe0f",["maps1.mp4","maps2.mp4","maps3.mp4"],function(){return document.getElementById("maps-form")},
function(){return document.getElementById("maps")}),new R("SHIPS","\ud83d\udea2","ships1.mp4 ships2.mp4 ships3.mp4 ships4.mp4 ships5.mp4 ships6.mp4".split(" "),function(){return document.getElementById("ships-form")},function(){return document.getElementById("ships")}),new R("\ud83d\udc4f","\ud83d\udc4f",["applause1.mp4","applause2.mp4","applause3.mp4"],function(){return document.getElementById("applause-form")},function(){return document.getElementById("applause")},2),new R("\ud83d\udc4e","\ud83d\udc4e",
["boo1.mp4","boo2.mp4","boo3.mp4"],function(){return document.getElementById("boo-form")},function(){return document.getElementById("boo")}),new R("STEEN","\ud83c\udf99\ufe0f",["steen1.mp4","steen2.mp4","steen3.mp4"],function(){return document.getElementById("steen-form")},function(){return document.getElementById("steen")})];function V(a,b){window.firebase.analytics instanceof Function&&window.firebase.analytics().logEvent(a,b)};function La(){var a,b;E(function(c){if(1==c.g)return c.j=2,B(c,window.firebase.messaging().getToken(),4);if(2!=c.g)return(a=c.s)?window.firebase.firestore().collection("fcmTokens").doc(a).set({uid:window.firebase.auth().currentUser.uid,timestamp:window.firebase.firestore.FieldValue.serverTimestamp()}):Ma(),ja(c);b=ka(c);console.error("Unable to get messaging token.",b);c.g=0})}
function Na(){var a,b;E(function(c){if(1==c.g)return c.j=2,B(c,window.firebase.messaging().getToken(),4);if(2!=c.g)return(a=c.s)&&window.firebase.firestore().collection("fcmTokens").doc(a).delete().catch(function(d){console.error("Error removing token: ",d)}),ja(c);b=ka(c);console.error("Unable to get messaging token.",b);c.g=0})}function Ma(){Notification.requestPermission().then(function(){La()}).catch(function(a){console.error("Unable to get permission to notify.",a)})};function Oa(a,b){this.ref=a;this.h=b;this.g=null;var c=this;a.onDisconnect().remove().then(function(){c.g=a.set(!0);c.g.catch(b)},b)}Oa.prototype.end=function(){if(this.g){var a=this;return this.g.then(function(){return a.ref.remove().then(function(){a.g=null;return a.end()},a.h)},function(){})}return this.ref.onDisconnect().cancel().catch(this.h)};
function W(){var a=window.firebase.auth(),b=window.firebase.database().ref("_firebase_extensions/presence"),c=this;this.ref=b;this.i=!1;this.g=this.user=null;this.j=!0;var d=this;b.root.child(".info/connected").on("value",function(h){d.i=h.val();d.g&&!d.i&&(d.g.end(),d.g=null);d.h()});a.onAuthStateChanged(function(h){!c.g||h&&h.uid===c.user.uid||(c.g=null);c.user=h;c.h()})}function Pa(){var a=Qa();a.j=!1;a.h();Promise.resolve()}
function Ra(){var a=Qa();a.j=!0;if(a.g){var b=a.g.end();a.g=null;return b}return Promise.resolve()}W.prototype.h=function(){if(!this.g&&!this.j&&this.i&&this.user){var a="";for(var b=0;20>b;b++)a+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));a=this.ref.child(this.user.uid).child("sessions").child(a);this.g=new Oa(a,this.l)}};
W.prototype.l=function(a){console.error("Error updating presence",a);this.g.end();this.g=null;"PERMISSION_DENIED"!==a.code&&setTimeout(this.h,1E3)};var Sa=null;function Qa(){Sa instanceof W||(Sa=new W);return Sa};function X(){return window.firebase.auth().currentUser.uid}function Ta(){return window.firebase.auth().currentUser.photoURL||"/images/profile_placeholder.png"};function Ua(){document.getElementById("message-form")&&document.getElementById("message-form").addEventListener("submit",Va);document.getElementById("sign-out").addEventListener("click",Wa);document.getElementById("sign-in").addEventListener("click",Xa);document.getElementById("sign-in-splash").addEventListener("click",Xa);document.getElementById("notifications-switch")&&document.getElementById("notifications-switch").addEventListener("click",function(c){c.target.checked?La():Na()});for(var a=n(U),
b=a.next();!b.done;b=a.next())b=b.value,b.L()&&b.L().addEventListener("submit",ra(Ya,b));O()&&(O().addEventListener("keyup",Za),O().addEventListener("change",Za));N()&&((new window.IntersectionObserver(Aa,{root:H(),rootMargin:"0px",threshold:.1})).observe(N()),document.getElementById("scroll-down-form")&&document.getElementById("scroll-down-form").addEventListener("submit",function(c){c.preventDefault();N().scrollIntoView(!1)}))}
function Xa(){var a=new firebase.auth.GoogleAuthProvider;firebase.auth().signInWithPopup(a);V("login",{method:""})}function Wa(){Ra().then(function(){return firebase.auth().signOut()})}function $a(a){U.forEach(function(b){a===Ka(b)&&window.firebase.firestore().collection(T(b)).doc(X()).set({profilePicUrl:Ta(),timestamp:window.firebase.firestore.FieldValue.serverTimestamp()}).catch(function(c){console.error("Error writing new message to database",c)})})}
function ab(a){$a(a);return window.firebase.firestore().collection("messages").add({uid:X(),name:window.firebase.auth().currentUser.displayName,text:a,profilePicUrl:Ta(),timestamp:window.firebase.firestore.FieldValue.serverTimestamp()}).catch(function(b){console.error("Error writing new message to database",b)})}function Va(a){return E(function(b){a.preventDefault();V("share",{method:"chat",content_type:"freeform",content_id:""});return B(b,bb(O().value),0)})}
function Ya(a,b){return E(function(c){if(1==c.g)return b.preventDefault(),V("share",{method:"chat",content_type:T(a),content_id:""}),B(c,bb(Ka(a)),2);a.g().setAttribute("disabled","true");setTimeout(function(){return Ia(a)},1E3);c.g=0})}
function bb(a){return E(function(b){if(1==b.g){var c;if(c=a)window.firebase.auth().currentUser?c=!0:(document.getElementById("must-signin-snackbar").MaterialSnackbar.showSnackbar({message:"You must sign-in first",timeout:2E3}),c=!1);c?b=B(b,ab(a),3):(b.g=0,b=void 0);return b}c=O();c.value="";c.parentNode.MaterialTextfield&&c.parentNode.MaterialTextfield.boundUpdateClassesHandler();Za();b.g=0})}
function Za(){O().value?document.getElementById("submit").removeAttribute("disabled"):document.getElementById("submit").setAttribute("disabled","true")};var cb=U.map(function(a){return Ka(a)});function db(a,b,c,d,h,l,f){this.id=a;this.timestamp=b;this.g=c;this.j=d;this.h=h;this.text=l;this.i=f;this.l=new Autolinker({S:!0,T:!1,U:!1})}db.prototype.remove=function(){var a=document.getElementById(this.id);a&&a.parentNode.removeChild(a)};
function eb(a){if(!cb.includes(a.text)){var b=ya(Y(a));if(!a.text||!fb(a,b)){var c=H().dataset.J||null===b&&a.g===X(),d=document.getElementById(a.id)||gb(a,b);a.h&&(d.querySelector(".pic").style.backgroundImage="url("+xa(a.h)+")");d.querySelector(".name").textContent=a.j;a.timestamp&&1E4<a.timestamp.getTime()&&(d.querySelector(".timestamp").textContent=a.timestamp.toLocaleDateString()+" "+a.timestamp.toLocaleTimeString());b=d.querySelector(".message");if(G.s.includes(X())&&!a.id.startsWith("callback-message-")&&
!d.querySelector(".admin")){var h=document.createElement("a");h.className="admin";h.setAttribute("href","#");h.textContent="delete";h.addEventListener("click",function(){firebase.firestore().collection("messages").doc(a.id).delete().catch(function(e){console.error("Error removing message: ",e)})});var l=d.querySelector(".byline");l.insertBefore(h,l.childNodes[0])}if(a.text)hb(a,b);else if(a.i){h=document.createElement("video");h.g=!0;h.autoplay=!0;h.muted=!0;h.className="callback-video";l=document.createElement("source");
l.src=a.i;l.type="video/mp4";var f=document.createTextNode("Your browser does not support the video tag.");h.innerHTML="";h.appendChild(l);h.appendChild(f);h.onloadedmetadata=function(){c&&N().scrollIntoView(!1)};b.innerHTML="";b.appendChild(h)}setTimeout(function(){d.classList.add("visible")},1);c&&N().scrollIntoView(!1);O()&&O().focus()}}}
function gb(a,b){var c=document.createElement("div");c.innerHTML='<div class="message-container"><div class="spacing"><div class="pic"></div></div><div class="message"></div><div class="byline"><div class="timestamp"></div><div class="name"></div></div></div>';c=c.firstChild;c.setAttribute("id",a.id);c.setAttribute("author",a.g);c.setAttribute("timestamp",Y(a));b||(b=N());H().insertBefore(c,b);return c}function Y(a){a.timestamp||(a.timestamp=new Date);return a.timestamp.getTime()}
function hb(a,b){b.textContent=a.text;b.innerHTML=DOMPurify.sanitize(b.innerHTML);b.innerHTML=a.l.link(b.innerHTML);b.innerHTML=b.innerHTML.replace(/\n/g,"<br>")}
function fb(a,b){for(b=b?b:N();b;){try{if(za(b)>Y(a)+5E3)break}catch(d){if(!(d instanceof I))throw d;}b=b.nextElementSibling}b||(b=N());var c=document.createElement("div");for(hb(a,c);b;){try{if(za(b)<Y(a)-5E3)break;if(b.getAttribute("author")===a.g&&b.querySelector(".message").innerHTML===c.innerHTML)return!0}catch(d){if(!(d instanceof I))throw d;}b=b.previousElementSibling}return!1}var ib=new Map,Z=[];
function jb(a){a.docChanges&&(a.docChanges().forEach(function(b){if("removed"===b.type)ib.get(b.doc.id).remove();else{var c=b.doc.data(),d=c.timestamp?c.timestamp.toDate():null;b=b.doc.id;c=new db(b,d,c.uid,c.name,c.profilePicUrl,c.text,c.videoUrl);ib.set(b,c);eb(c)}}),a.empty||Z.push(a.query.startAfter(a.docs[a.size-1]).onSnapshot(jb,kb)))}function kb(a){console.error("Error querying Firestore: ",a)}function lb(){for(var a=n(Z),b=a.next();!b.done;b=a.next())b=b.value,b();Z=[]};function mb(a){this.o=a;this.h=Date.now()-this.o.weight*G.g;this.g=this.C=null}function nb(a){a.o.h.forEach(function(b){var c=document.createElement("audio");c.id=b;c.h=!0;c.hidden=!0;c.preload="auto";c.src="video/"+b;Ha().appendChild(c)})}
function ob(a,b){if(b){var c=Math.max(a.h,Date.now()-a.o.weight*G.g),d=b.filter(function(h){return pb(h.data())>c});0<d.length&&(b=pb(b[0].data()),0<b&&(d.length>=sa(a.o.weight)?(a.g&&(a.g.g.remove(),a.g=null),a.h=b+1E3,qb(a,b+1),V("screen_view",{screen_name:T(a.o)})):(d=d.map(function(h){return{uid:h.id,R:h.data().profilePicUrl}}),rb(a,b,d,c))))}}
function rb(a,b,c,d){if(!a.g||a.g.timestamp<d)a.g=new sb(a.o.i,Ja(a.o),b,a.o.weight),tb(a.g);b=n(c);for(c=b.next();!c.done;c=b.next()){var h=c.value;c=a.g;d=h.uid;h=h.R;if(!c.h.includes(d)){c.h.push(d);var l=c.g.querySelector(".callback-progress-bar");l.style.width=100*c.h.length/sa(c.weight)+"%";var f=document.createElement("div");f.className="callback-progress-voice";h&&(f.style.backgroundImage="url("+xa(h)+")");l.insertBefore(f,c.g.querySelector(".callback-progress-callback"));(H().dataset.J||
d===X())&&N().scrollIntoView(!1)}}}function qb(a,b){var c=a.o.h[Math.floor(Math.random()*a.o.h.length)],d=ub.next();b=new Date(b);a=Ja(a.o);a=new db(d,b,"",a,"images/adventureharvey.jpg","","video/"+c);ib.set(d,a);eb(a);document.getElementById(c).play()}var ub=new wa;function sb(a,b,c,d){this.id=ub.next();this.i=a;this.j=b;this.timestamp=c;this.weight=d;this.g=null;this.h=[]}
function tb(a){if(!document.getElementById(a.id)){var b=document.createElement("div");b.innerHTML='<div class="message-container">  <div class="spacing"><div class="callback-emoji"></div></div>  <div class="callback-progress">    <div class="callback-progress-bar">      <div class="callback-progress-callback"></div>    </div>  </div></div>';a.g=b.firstChild;a.g.setAttribute("id",a.id);a.g.setAttribute("timestamp",a.timestamp);a.g.querySelector(".callback-emoji").innerText=a.i;a.g.querySelector(".callback-progress-callback").innerText=
a.j;(b=ya(a.timestamp))||(b=N());H().insertBefore(a.g,b);setTimeout(function(){a.g.classList.add("visible")},1);setTimeout(function(){var c=a.g.querySelector(".callback-progress-bar");c.style.transition="opacity "+(a.weight*G.g-1E3)+"ms ease-in";c.style.opacity=0},1001);setTimeout(function(){var c=a.g.querySelector(".callback-progress-bar");c.classList.remove("callback-progress-bar");c.classList.add("callback-progress-bar-expired");c.removeAttribute("style")},a.weight*G.g)}H().dataset.J&&N().scrollIntoView(!1)}
function pb(a){return a&&a.timestamp&&a.timestamp.toMillis?a.timestamp.toMillis():-1}var vb=U.map(function(a){return new mb(a)});function wb(a){a.j&&document.getElementById("error-link")?(Da().removeAttribute("hidden"),Ca().setAttribute("hidden",!0),document.getElementById("promo").setAttribute("hidden",!0),document.getElementById("error-link").setAttribute("href",a.j),V("screen_view",{screen_name:"error"})):(Ca().hasAttribute("hidden")&&(Ca().removeAttribute("hidden"),document.getElementById("promo")&&document.getElementById("promo").setAttribute("hidden",!0),Da()&&Da().setAttribute("hidden",!0),V("screen_view",{screen_name:"main"})),
document.getElementById("user-count").textContent=a.l,document.getElementById("user-count").parentElement.removeAttribute("hidden"),P()&&(a.i?(P().src="https://www.youtube.com/embed/"+a.i,P().removeAttribute("hidden")):P().setAttribute("hidden",!0)),Q()&&(a.h?(Q().src="https://www.youtube.com/live_chat?v="+a.h+("&embed_domain="+window.location.hostname),Q().removeAttribute("hidden")):Q().setAttribute("hidden",!0)),Ga()&&(a.i||a.h?Ga().removeAttribute("hidden"):Ga().setAttribute("hidden",!0)),xb())}
function yb(a){var b,c,d,h,l;return E(function(f){if(1==f.g){if(!a){Ea().setAttribute("hidden","true");document.getElementById("user-pic").setAttribute("hidden","true");document.getElementById("kebab-menu").setAttribute("hidden","true");document.getElementById("sign-in").removeAttribute("hidden");document.getElementById("signin-splashscreen").removeAttribute("hidden");Fa().setAttribute("hidden","true");b=n(vb);for(c=b.next();!c.done;c=b.next())d=c.value,d.C&&(d.C(),d.C=null);lb();f.g=0;return}Pa();
h=Ta();l=window.firebase.auth().currentUser.displayName;document.getElementById("user-pic").style.backgroundImage="url("+xa(h)+")";Ea().textContent=l;Ea().removeAttribute("hidden");document.getElementById("user-pic").removeAttribute("hidden");document.getElementById("kebab-menu").removeAttribute("hidden");document.getElementById("sign-in").setAttribute("hidden","true");document.getElementById("signin-splashscreen").setAttribute("hidden","true");La();Ha().innerHTML="";vb.forEach(function(e){return nb(e)});
wb(G);if(G.H||!M()){zb();f.g=0;return}return B(f,Ab(),4)}zb();f.g=0})}function zb(){Fa().removeAttribute("hidden");M()&&M().setAttribute("hidden",!0);O()&&(O().removeAttribute("disabled"),O().focus());var a=G.D,b=firebase.firestore().collection("messages").limit(12);a&&(b=b.where("timestamp",">",a));b=b.orderBy("timestamp","desc");0==Z.length&&Z.push(b.onSnapshot(jb,kb));V("screen_view",{screen_name:"chat"})}
function Ab(){M().removeAttribute("hidden");Fa().setAttribute("hidden",!0);V("screen_view",{screen_name:"introduction"});return new Promise(function(a){document.getElementById("intro-button").addEventListener("click",function(){Ha().querySelectorAll("audio").forEach(function(b){b.volume=0;b.muted=!0;b.playbackRate=2;b.onended=function(){b.volume=1;b.muted=!1;b.playbackRate=1;b.onended=null};b.play()});U.forEach(function(b){return Ia(b)});G.H=!0;a()})})}
function xb(){for(var a={},b=n(vb),c=b.next();!c.done;a={B:a.B},c=b.next())a.B=c.value,a.B.C&&a.B.C(),c=window.firebase.firestore().collection(T(a.B.o)).orderBy("timestamp","desc").limit(sa(a.B.o.weight)),a.B.C=c.onSnapshot(function(d){return function(h){ob(d.B,h.docs)}}(a),function(d){console.error("Error querying Firestore: ",d)})};window.firebase&&firebase.app instanceof Function&&firebase.app().options?(firebase.performance(),firebase.analytics(),Ua(),Qa(),firebase.auth().onAuthStateChanged(yb),G.A.push(wb),ta()):window.alert("You have not configured and imported the Firebase SDK. Make sure you go through the codelab setup instructions and make sure you are running the codelab using `firebase serve`");
